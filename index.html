<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>UI Registry Office Navigation System</title>

  <!-- Tailwind CSS via CDN (for demo) -->
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100">

  <!-- NAVIGATION BAR -->
  <nav class="bg-white shadow">
    <div class="max-w-7xl mx-auto px-4 py-3 flex justify-between items-center">
      <!-- Left: Logo + Title -->
      <div class="flex items-center space-x-4">
        <img 
          src="images/ui-logo.png" 
          alt="University of Ibadan Logo" 
          class="h-10 w-auto" 
        />
        <span class="font-semibold text-lg md:text-xl">
          University of Ibadan Registry
          <br class="hidden md:block"/>Office Navigation System
        </span>
      </div>
      <!-- Right: Buttons -->
      <div class="flex items-center space-x-4">
        <button class="text-blue-600 font-medium hover:text-blue-800 transition-colors">
          Scan QR Code
        </button>
        <button class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 transition-colors">
          Login
        </button>
      </div>
    </div>
  </nav>

  <!-- HERO / HEADER SECTION -->
  <!-- Replace background image URL with your own if desired -->
  <header 
    class="relative bg-cover bg-center h-64" 
    style="background-image: url('images/image.png');"
  >
    <!-- Dark overlay -->
    <div class="absolute inset-0 bg-black bg-opacity-40"></div>
    <div 
      class="relative z-10 flex flex-col justify-center items-center text-center h-full text-white px-4"
    >
      <h1 class="text-3xl md:text-4xl font-bold mb-4">
        Find your way around the Registry with ease
      </h1>

      <!-- Search bar -->
      <div class="w-full max-w-xl">
        <div class="flex items-center bg-white rounded overflow-hidden shadow">
          <input 
            id="searchInput"
            type="text" 
            placeholder="Search for an office or service..." 
            class="flex-grow px-4 py-2 focus:outline-none text-gray-800"
          />
          <button 
            id="searchButton"
            class="bg-blue-600 text-white px-4 py-2 hover:bg-blue-700 transition-colors"
          >
            Search
          </button>
        </div>
      </div>
    </div>
  </header>

  <!-- SEARCH RESULTS SECTION (initially hidden) -->
  <section id="searchResultsSection" class="py-8 hidden">
    <div class="max-w-7xl mx-auto px-4">
      <h2 class="text-2xl font-semibold mb-4 text-gray-800">Search Results</h2>
      <div id="resultsContainer" class="space-y-4">
        <!-- Matching offices will be rendered here -->
      </div>
    </div>
  </section>

  <!-- DIRECTIONS SECTION (initially hidden) -->
  <section id="directionsSection" class="py-8 hidden">
    <div class="max-w-7xl mx-auto px-4">
      <h2 class="text-2xl font-semibold mb-4 text-gray-800">Navigation Direction</h2>
      <!-- You can replace this with an actual map or any relevant graphic -->
      <img 
        src="images/example_map.png" 
        alt="Navigation Map" 
        class="mb-4 w-full max-w-md mx-auto rounded shadow"
      />
      <!-- Step-by-step instructions container -->
      <div id="directionInstructions" class="space-y-2 text-gray-800">
        <!-- Steps will be injected here by JavaScript -->
      </div>
    </div>
  </section>

  <!-- QUICK LINKS SECTION (Optional) -->
  <section class="py-8 bg-white">
    <div class="max-w-7xl mx-auto px-4">
      <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-6 gap-4 text-center">
        <a href="#" class="hover:bg-gray-100 rounded py-4 transition-colors">
          <span class="block text-blue-600 font-semibold">Transcripts</span>
        </a>
        <a href="#" class="hover:bg-gray-100 rounded py-4 transition-colors">
          <span class="block text-blue-600 font-semibold">Verification</span>
        </a>
        <a href="#" class="hover:bg-gray-100 rounded py-4 transition-colors">
          <span class="block text-blue-600 font-semibold">
            Undergraduate Admissions
          </span>
        </a>
        <a href="#" class="hover:bg-gray-100 rounded py-4 transition-colors">
          <span class="block text-blue-600 font-semibold">PG Admissions</span>
        </a>
        <a href="#" class="hover:bg-gray-100 rounded py-4 transition-colors">
          <span class="block text-blue-600 font-semibold">Exams &amp; Records</span>
        </a>
        <a href="#" class="hover:bg-gray-100 rounded py-4 transition-colors">
          <span class="block text-blue-600 font-semibold">Others</span>
        </a>
      </div>
    </div>
  </section>

  <!-- INFO SECTION -->
  <section class="py-8">
    <div class="max-w-7xl mx-auto px-4">
      <div class="flex flex-col md:flex-row items-center space-y-6 md:space-y-0 md:space-x-8">
        <!-- Image -->
        <div class="md:w-1/2">
          <img 
            src="images/ui_image_registry.png" 
            alt="UI Registry Building" 
            class="rounded shadow w-full"
          />
        </div>
        
        <!-- Text -->
        <div class="md:w-1/2">
          <h2 class="text-2xl md:text-3xl font-bold mb-4">
            Welcome to the University of Ibadan Registry Office Navigation System
          </h2>
          <p class="mb-4 text-gray-700">
            Easily find offices and services within the Registry 
            to get the assistance you need. You can browse through 
            available services, locate offices, and more.
          </p>
          <button 
            class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 transition-colors"
          >
            View All News from UI Registry
          </button>
        </div>
      </div>
    </div>
  </section>

  <!-- FOOTER -->
  <footer class="bg-gray-800 text-gray-200 py-4">
    <div 
      class="max-w-7xl mx-auto px-4 flex flex-col md:flex-row justify-between items-center space-y-2 md:space-y-0"
    >
      <p class="text-sm">
        &copy; 2025. Matric No: 214857 for University of Ibadan Registry
      </p>
      <p class="text-sm">
        Go to 
        <a 
          href="https://www.ui.edu.ng" 
          target="_blank" 
          class="text-blue-400 hover:underline ml-1"
        >
          www.ui.edu.ng
        </a>
      </p>
    </div>
  </footer>

  <!-- SCRIPT: Fetch JSON, Filter, and Show Directions -->
  <script>
    let officesData = [];

    // 1. Fetch the JSON data on page load
    fetch('offices.json')
      .then(response => response.json())
      .then(data => {
        officesData = data;
      })
      .catch(error => {
        console.error('Error fetching offices.json:', error);
      });

    // 2. Handle Search
    document.getElementById('searchButton').addEventListener('click', () => {
      const query = document.getElementById('searchInput').value.trim().toLowerCase();
      const resultsContainer = document.getElementById('resultsContainer');
      const searchResultsSection = document.getElementById('searchResultsSection');
      resultsContainer.innerHTML = ''; // Clear old results

      if (!query) {
        alert('Please enter a search term');
        return;
      }

      // Filter officesData
      const filteredResults = officesData.filter(item => {
        const combinedText = (item.name + ' ' + item.description).toLowerCase();
        return combinedText.includes(query);
      });

      // Show the results section
      searchResultsSection.classList.remove('hidden');

      if (filteredResults.length === 0) {
        resultsContainer.innerHTML = `
          <div class="p-4 bg-yellow-50 border border-yellow-200 rounded">
            No matching offices or services found.
          </div>
        `;
        return;
      }

      // Render each matching office
      filteredResults.forEach(office => {
        const card = document.createElement('div');
        card.className = 'bg-white shadow rounded p-4 md:p-6 flex flex-col md:flex-row';

        // If there's an image, render it
        let imageHTML = '';
        if (office.image) {
          imageHTML = `
            <img 
              src="${office.image}" 
              alt="${office.name}" 
              class="w-16 h-16 object-cover mr-4 rounded mb-4 md:mb-0"
            />
          `;
        }

        card.innerHTML = `
          ${imageHTML}
          <div class="flex-grow">
            <h3 class="text-xl font-semibold mb-2">${office.name}</h3>
            <p class="mb-1">${office.description}</p>
            <p class="text-gray-700 mb-1"><strong>Location:</strong> ${office.location || 'N/A'}</p>
            <p class="text-gray-700 mb-1"><strong>Contact:</strong> ${office.contact || 'N/A'}</p>
            <p class="text-gray-700 mb-1"><strong>Email:</strong> ${office.email || 'N/A'}</p>
          </div>
          <div class="mt-4 md:mt-0 md:ml-4 flex items-center">
            <button
              class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 transition-colors"
              onclick="startNavigation(${office.latitude || 0}, ${office.longitude || 0})"
            >
              Navigate me there
            </button>
          </div>
        `;

        resultsContainer.appendChild(card);
      });
    });

    // 3. Start Navigation: get user location, call Directions API, display instructions
    function startNavigation(destLat, destLng) {
      if (!destLat || !destLng) {
        alert('No coordinates available for this office.');
        return;
      }

      // Show the directions section
      document.getElementById('directionsSection').classList.remove('hidden');

      if (!navigator.geolocation) {
        alert('Geolocation is not supported by your browser.');
        return;
      }

      // Get user's current location
      navigator.geolocation.getCurrentPosition(
        position => {
          const userLat = position.coords.latitude;
          const userLng = position.coords.longitude;
          getDirections(userLat, userLng, destLat, destLng);
        },
        error => {
          console.error('Error getting location:', error);
          alert('Unable to retrieve your location.');
        }
      );
    }

    // 4. Call Google Maps Directions API to get step-by-step directions
    function getDirections(origLat, origLng, destLat, destLng) {
      const directionsUrl = `https://maps.googleapis.com/maps/api/directions/json?origin=${origLat},${origLng}&destination=${destLat},${destLng}&mode=driving&key=YOUR_GOOGLE_MAPS_API_KEY`;

      fetch(directionsUrl)
        .then(res => res.json())
        .then(data => {
          if (data.status === 'OK') {
            const steps = data.routes[0].legs[0].steps;
            displaySteps(steps);
          } else {
            console.error('Directions request failed:', data.status);
            alert('Unable to fetch directions. Check console for details.');
          }
        })
        .catch(err => {
          console.error('Error fetching directions:', err);
        });
    }

    // 5. Display textual directions in #directionInstructions
    function displaySteps(steps) {
      const instructionsDiv = document.getElementById('directionInstructions');
      instructionsDiv.innerHTML = ''; // Clear old steps

      steps.forEach((step, index) => {
        const stepDiv = document.createElement('div');
        stepDiv.classList.add('mb-3', 'p-3', 'bg-white', 'shadow', 'rounded');

        // Directions API returns HTML instructions, plus distance/duration
        const instruction = step.html_instructions; 
        const distance = step.distance ? step.distance.text : '';
        const duration = step.duration ? step.duration.text : '';

        stepDiv.innerHTML = `
          <div class="font-bold mb-1">Step ${index + 1}:</div>
          <div class="text-gray-800 mb-1">${instruction}</div>
          <div class="text-sm text-gray-600">
            <strong>Distance:</strong> ${distance}, <strong>Duration:</strong> ${duration}
          </div>
        `;
        instructionsDiv.appendChild(stepDiv);
      });
    }
  </script>
</body>
</html>
